\documentclass[12pt]{amsart}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\title{molten PPCA}
\author{Ko ABE}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle

\section{Estimation}

Now, consider following data generating process; 
\begin{align*}
y_n &\sim \mathcal{N}\left(\sum_{l=1}^L \prod_{d=1}^D\mu_{dl}^{x_{nd}}, \lambda^{-1}\right)\\
\mu_{dl} & \sim \mathcal{N}(0,\tau^{-1}) % \lambda &\sim \mathcal{G}(a,b),
\end{align*}
where $\mathcal{N}(\mu,\sigma^2)$ is normal distribution with mean $\mu$ and variance $\sigma^2$. 

After some manipulation, we get following result; 
\begin{align*}
&\sum_{n=1}^{N} \log p(\mu_{dl}|y, X, \mu_{dl}^{(c)},\sigma^2)\\
&= \sum_{n=1}^{N}\left(-\frac{\lambda}{2}\left\{ y_n -\sum_{l=1}^L\prod_{j=1}^D \mu_{j,l}^{x_{nj}} \right\}^2\right) -\tau \frac{\mu_{dl}^2}{2} + C\\
&= \sum_{n=1}^{N}\left(-\frac{\lambda}{2}\left\{ y_n -\sum_{l'\neq l}\prod_{j=1}^D \mu_{jl'}^{x_{n,j}}-\prod_{j=1}^D \mu_{jl}^{x_{nj}} \right\}^2\right)-\tau \frac{\mu_{jl}^2}{2}+ C\\
&=\sum_{n=1}^{N}\left(-\frac{\lambda}{2}\left\{\prod_{j =1}^D \mu_{jl}^{2x_{nj}}-2\prod_{j=1}^D \mu_{jl}^{x_{nj}}\left(y_n -\sum_{l'\neq l}\prod_{j=1}^D \mu_{jl'}^{x_{n,j}}\right) \right\}\right) -\tau \frac{\mu_{dl}^2}{2} + C\\
&=-\frac{\lambda}{2}\left\{\sum_{n=1}^N \left( \mu_{dl}^{2x_{nd}}\prod_{d'\neq d} \mu_{d'l}^{2x_{nd'}} - 2 \mu_{dl}^{x_{nd}}\prod_{d' \neq d} \mu_{d'l}^{x_{nd'}}\left(y_n -\sum_{l'\neq l}\prod_{j=1}^D \mu_{jl'}^{x_{nd}}\right) \right)\right\} -\tau \frac{\mu_{dl}^2}{2} + C\\
&=-\frac{\tau  + \lambda \sum_{n=1}^N x_{nd}\prod_{d' \neq d} \mu_{d'l}^{2x_{nd'}} }{2} \\
&\quad \times \left(\mu_{dl}^{2}-2 \mu_{dl} \lambda \frac{\sum_{n=1}^N x_{nd}\prod_{d' \neq d} \mu_{d'l}^{x_{nd'}} \left[y_n -\sum_{l'\neq l}\prod_{j=1}^D \mu_{jl'}^{x_{nj}}  \right] }{\sum_{n=1}^N x_{nd}\prod_{d\neq d'} \mu_{d'l}^{2x_{nd'}} }\right) + C,
\end{align*}
where $C$ is constant term which not depends on $\mu_{dl}$.

Using mean-field approximation, we get following variational posterior distribution; 
\begin{align*}
q(\mu_{dl})= \mathcal{N}(\hat \mu_{dl},\hat \sigma_{dl}), 
\end{align*}
where $\hat \mu_{dl}$ and $\hat \sigma_{dl}$ are defined by
\begin{align*}
\hat \mu_{dl} &=\frac{\sum_{n=1}^N x_{nd}\prod_{d' \neq d} \langle \mu_{d'l} \rangle ^{x_{nd'}} \left[y_n -\sum_{l'\neq l}\prod_{j=1}  \langle \mu_{jl'} \rangle ^{x_{nj}}  \right]}{\tau/\lambda + \left( \sum_{n=1}^N x_{nd}\prod_{d\neq d'} \langle \mu_{d'l}^{2} \rangle ^{x_{nd'}} \right)},\\
\hat \sigma^2 &=\left(\tau + \lambda \left\{\sum_{n=1}^N x_{nd}\prod_{d' \neq d}  \langle \mu_{d'l}^2 \rangle ^{x_{nd'}}\right\} \right)^{-1},
\end{align*}
where $\langle x \rangle$ is expectation of $x$ under the variational posterior distribution.

\end{document}  
